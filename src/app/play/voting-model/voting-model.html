<svg width="100%" height="100%">
    <!-- draw background cues -->
    @for (voterGroup of voterGroups(); track voterGroup) {
        @if (isSingleVoter(voterGroup)) {
            @let ballot = castBallots().get(voterGroup)!()[0];
            <g appCues
                [votingMethod]="votingMethod()"
                [voterOpinions]="voterGroup.getReferenceOpinions()"
                [ballot]="ballot"
            />
        }
    }

    <!-- draw voter groups -->
    @for (voterGroup of voterGroups(); track voterGroup) {
        <g
            cdkDrag
            [cdkDragFreeDragPosition]="opinionsToPoint(voterGroup.getReferenceOpinions())"
            [cdkDragConstrainPosition]="constrainPosition.bind(this)"
            (cdkDragMoved)="voterGroup.getReferenceOpinions.set(pointToOpinions($event.pointerPosition))"
        >
            @let ballots = castBallots().get(voterGroup)!();
            @if (isSingleVoter(voterGroup)) {
                @let ballot = ballots[0];
                <g appSingleVoter
                    [votingMethod]="votingMethod()"
                    [ballot]="ballot"
                />
            } @else if (isGaussianVoters(voterGroup)) {
                <g appGaussianVoter
                    [votingMethod]="votingMethod()"
                    [ballots]="ballots"
                    [offsets]="voterGroup.offsets"
                />
            }
            <circle cdkDragHandle class="draggaHandle" cx="0" cy="0" r="30" opacity="0"/>
        </g>
    }

    <!-- draw candidates -->
    @for (candidate of candidates(); track candidate) {
        <g
            cdkDrag
            [cdkDragFreeDragPosition]="opinionsToPoint(candidate.getOpinions())"
            [cdkDragConstrainPosition]="constrainPosition.bind(this)"
            (cdkDragMoved)="candidate.getOpinions.set(pointToOpinions($event.pointerPosition))"
        >
            <g appCandidate
                [candidate]="candidate"
            />
            <circle cdkDragHandle class="draggaHandle" cx="0" cy="0" r="30" opacity="0"/>
        </g>
    }
</svg>
